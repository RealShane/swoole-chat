<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="__API__/js/jquery.min.js"></script>
</head>
<body>
<div id="welcome"></div>
<div>
    <input type="text" id="input"/>
    <input type="button" onclick="send()" value="发送"/>
</div>
<div id="message"></div>
<script>
    let wsServer = 'wss://apptest.huihuagongxue.top:9502?token=test-token',
        websocket = null;
    link();
    function link(){
        websocket = new WebSocket(wsServer);

        websocket.onopen = function (res) {
            $("#welcome").append(
                "<h1>连接成功！欢迎</h1>"
            );
        };

        websocket.onclose = function (res) {
            websocket.close();
            relink();
        };

        websocket.onmessage = function (res) {
            $("#message").append(
                "<h3>" + res.data + "</h3>"
            );
        };

        websocket.onerror = function (res, e) {
            websocket.close();
            relink();
        };
    }

    function send() {
        websocket.send(JSON.stringify($("#input").val()));
    }

    function relink(){
        setTimeout(function () {
            link();
        }, 1000);
    }
</script>
</body>
</html>