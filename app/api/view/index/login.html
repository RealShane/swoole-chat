<!DOCTYPE html>
<html lang="en">
<head>
    {include file="public/_meta" /}
</head>
<body class="layui-card">
<div style="text-align: center">
    <form class="layui-form layui-card-body">
        <div class="layui-form-item layui-inline">
            <input name="username" type="text" class="layui-form layui-input-inline">
        </div>
        <div class="layui-form-item layui-inline">
            <input name="password" type="password" class="layui-form layui-input-inline">
        </div>
        <div class="layui-form-item layui-inline">
            <button class="layui-btn" lay-submit lay-filter="commit">登陆</button>
        </div>
    </form>
</div>
<script>
    let token = getApiToken();
    layui.use(['form', 'layer'], function(){
        var form = layui.form,
            layer = layui.layer;
        if (!empty(token)){
            layer.msg('已登录，无需重复登陆!', function () {
                $(window).attr('location', '/api/View/User/index');
            });
        }
        form.on('submit(commit)', function(res) {
            $.ajax({
                type : "POST",
                contentType : "application/x-www-form-urlencoded",
                url : '/api/User/login',
                data : {
                    username : res.field.username,
                    password : res.field.password,
                },
                success : function(res) {
                    if(res.status === config('failed')){
                        layer.msg(res.message);
                    }else if(res.status === config('success')){
                        layer.msg(res.result, function() {
                            $(window).attr('location', '/api/View/User/index');
                        });
                    }
                }
            });
            return false;
        });
    });
</script>
</body>
</html>